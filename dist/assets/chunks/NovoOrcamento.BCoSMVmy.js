import{j as e}from"../vendor/vendor-query.CYtcMPNU.js";import{u as a,a as s}from"../vendor/vendor-react.C0-ekqbG.js";import{k as i,u as o,a as t,A as r,o as n,j as l,p as d,b as c,c as m,d as u,g as x,e as p,L as v,I as h}from"../entry/index.BTJ1QXK9.js";import{u as j}from"./useOrcamentos.CwFtpo99.js";import{S as g}from"./search.x8-RwjLr.js";import{P as b}from"./plus.BUsgb2rM.js";import{T as f}from"./trash-2.D_atw9Vw.js";import{S as N}from"./save.CLzdvmgn.js";import{S as y}from"./send.Hwod_5Dq.js";import"../vendor/vendor-supabase.CnuDrxPg.js";import"../vendor/vendor-utils.Cp7Vw4Xn.js";const w=i("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);function q(){const i=a(),{user:q}=o(),{criarOrcamento:I}=j(),[D,S]=s.useState(!1),[C,E]=s.useState([]),[A,k]=s.useState([]),[F,M]=s.useState([]),[R,P]=s.useState({}),[z,O]=s.useState({clienteId:"",equipamentoId:"",itens:[],valorDesconto:0,observacoes:"",validadeAte:new Date(Date.now()+6048e5).toISOString().split("T")[0]}),[T,U]=s.useState([]),[$,L]=s.useState({tipo:"peca",descricao:"",quantidade:1,valorUnitario:0}),[V,B]=s.useState(!1),[G,H]=s.useState("");s.useEffect((()=>{W()}),[]),s.useEffect((()=>{z.clienteId&&K(z.clienteId)}),[z.clienteId]);const W=async()=>{try{const e=[{id:"cliente-1",nome:"João Silva",email:"joao@email.com",telefone:"(11) 99999-9999",cpf:"123.456.789-00",criadoEm:new Date,atualizadoEm:new Date},{id:"cliente-2",nome:"Maria Santos",email:"maria@email.com",telefone:"(11) 88888-8888",cpf:"987.654.321-00",criadoEm:new Date,atualizadoEm:new Date}],a=[{id:"peca-1",nome:"Memória RAM 8GB DDR4",tipo:"memoria",marca:"Kingston",modelo:"ValueRAM",descricao:"Memória RAM 8GB DDR4 2400MHz",preco:250,quantidadeEstoque:15,estoqueMinimo:5,ativa:!0,criadaEm:new Date,atualizadaEm:new Date},{id:"peca-2",nome:"SSD 500GB",tipo:"ssd",marca:"Samsung",modelo:"980 EVO",descricao:"SSD NVMe 500GB Samsung 980 EVO",preco:350,quantidadeEstoque:8,estoqueMinimo:3,ativa:!0,criadaEm:new Date,atualizadaEm:new Date},{id:"peca-3",nome:"Fonte 500W",tipo:"fonte",marca:"Corsair",modelo:"CV500",descricao:"Fonte 500W 80+ Bronze",preco:280,quantidadeEstoque:12,estoqueMinimo:4,ativa:!0,criadaEm:new Date,atualizadaEm:new Date}];E(e),M(a)}catch(e){}},K=async e=>{try{k([{id:"equip-1",clienteId:e,tipo:"notebook",marca:"Dell",modelo:"Inspiron 15",numeroSerie:"DL123456",descricaoProblema:"Lentidão e travamentos",criadoEm:new Date,atualizadoEm:new Date},{id:"equip-2",clienteId:e,tipo:"desktop",marca:"HP",modelo:"Pavilion",numeroSerie:"HP789012",descricaoProblema:"Não liga",criadoEm:new Date,atualizadoEm:new Date}])}catch(a){}},Q=()=>{const e=T.filter((e=>"peca"===e.tipo)).reduce(((e,a)=>e+a.valorTotal),0),a=T.filter((e=>"servico"===e.tipo)).reduce(((e,a)=>e+a.valorTotal),0),s=e+a;return{valorPecas:e,valorServicos:a,subtotal:s,valorTotal:s-z.valorDesconto}},J=async(e=!1)=>{if((()=>{const e={};return z.clienteId||(e.clienteId="Selecione um cliente"),z.equipamentoId||(e.equipamentoId="Selecione um equipamento"),0===T.length&&(e.itens="Adicione pelo menos um item ao orçamento"),z.validadeAte||(e.validadeAte="Defina a data de validade"),P(e),0===Object.keys(e).length})())try{S(!0);const{valorPecas:e,valorServicos:a,valorTotal:s}=Q(),o={clienteId:z.clienteId,equipamentoId:z.equipamentoId,itens:T.map((e=>({tipo:e.tipo,pecaId:e.pecaId,descricao:e.descricao,quantidade:e.quantidade,valorUnitario:e.valorUnitario}))),observacoes:z.observacoes,valorDesconto:z.valorDesconto,validadeAte:new Date(z.validadeAte),valorPecas:e,valorServicos:a,valorTotal:s};await I(o),i("/orcamentos")}catch(a){P({...R,submit:"Erro ao salvar orçamento. Tente novamente."})}finally{S(!1)}},X=F.filter((e=>e.ativa&&(e.nome.toLowerCase().includes(G.toLowerCase())||e.marca?.toLowerCase().includes(G.toLowerCase())||e.modelo?.toLowerCase().includes(G.toLowerCase())))),{valorPecas:Y,valorServicos:Z,subtotal:_,valorTotal:ee}=Q();return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs(t,{variant:"outline",onClick:()=>i("/orcamentos"),children:[e.jsx(r,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Novo Orçamento"}),e.jsx("p",{className:"text-gray-600",children:"Crie um novo orçamento para seu cliente"})]})]}),R.submit&&e.jsxs(n,{className:"mb-6",children:[e.jsx(l,{className:"h-4 w-4"}),e.jsx(d,{children:R.submit})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(u,{children:"Cliente e Equipamento"}),e.jsx(x,{children:"Selecione o cliente e equipamento para este orçamento"})]}),e.jsx(p,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"cliente",children:"Cliente *"}),e.jsxs("select",{id:"cliente",value:z.clienteId,onChange:e=>O({...z,clienteId:e.target.value,equipamentoId:""}),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(R.clienteId?"border-red-500":"border-gray-300"),children:[e.jsx("option",{value:"",children:"Selecione um cliente"}),C.map((a=>e.jsxs("option",{value:a.id,children:[a.nome," - ",a.telefone]},a.id)))]}),R.clienteId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:R.clienteId})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"equipamento",children:"Equipamento *"}),e.jsxs("select",{id:"equipamento",value:z.equipamentoId,onChange:e=>O({...z,equipamentoId:e.target.value}),disabled:!z.clienteId,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${R.equipamentoId?"border-red-500":"border-gray-300"} ${z.clienteId?"":"bg-gray-100"}`,children:[e.jsx("option",{value:"",children:"Selecione um equipamento"}),A.map((a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," - ",a.tipo]},a.id)))]}),R.equipamentoId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:R.equipamentoId})]})]})})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(u,{children:"Itens do Orçamento"}),e.jsx(x,{children:"Adicione peças e serviços ao orçamento"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"border rounded-lg p-4 mb-4 bg-gray-50",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Adicionar Item"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"tipo",children:"Tipo"}),e.jsxs("select",{id:"tipo",value:$.tipo,onChange:e=>L({...$,tipo:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"peca",children:"Peça"}),e.jsx("option",{value:"servico",children:"Serviço"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(v,{htmlFor:"descricao",children:"Descrição"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"descricao",value:$.descricao,onChange:e=>L({...$,descricao:e.target.value}),placeholder:"peca"===$.tipo?"Digite ou busque uma peça":"Descrição do serviço"}),"peca"===$.tipo&&e.jsx(t,{type:"button",variant:"outline",size:"sm",className:"absolute right-1 top-1 h-8",onClick:()=>B(!V),children:e.jsx(g,{className:"w-4 h-4"})})]}),V&&"peca"===$.tipo&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:[e.jsx("div",{className:"p-2",children:e.jsx(h,{placeholder:"Buscar peças...",value:G,onChange:e=>H(e.target.value)})}),e.jsxs("div",{className:"max-h-48 overflow-auto",children:[X.map((a=>e.jsxs("div",{className:"p-2 hover:bg-gray-100 cursor-pointer border-b",onClick:()=>(e=>{L({...$,pecaId:e.id,descricao:e.nome,valorUnitario:e.preco}),B(!1),H("")})(a),children:[e.jsx("div",{className:"font-medium",children:a.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:[a.marca," ",a.modelo," - R$ ",a.preco.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Estoque: ",a.quantidadeEstoque," unidades"]})]},a.id))),0===X.length&&e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Nenhuma peça encontrada"})]})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"quantidade",children:"Qtd"}),e.jsx(h,{id:"quantidade",type:"number",min:"1",value:$.quantidade,onChange:e=>L({...$,quantidade:parseInt(e.target.value)||1})})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"valor",children:"Valor Unit."}),e.jsx(h,{id:"valor",type:"number",step:"0.01",min:"0",value:$.valorUnitario,onChange:e=>L({...$,valorUnitario:parseFloat(e.target.value)||0})})]})]}),R.novoItem&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:R.novoItem}),e.jsxs(t,{onClick:()=>{if(!$.descricao||!$.quantidade||!$.valorUnitario)return void P({...R,novoItem:"Preencha todos os campos do item"});const e={id:Date.now().toString(),tipo:$.tipo||"peca",pecaId:$.pecaId,descricao:$.descricao||"",quantidade:$.quantidade||1,valorUnitario:$.valorUnitario||0,valorTotal:($.quantidade||1)*($.valorUnitario||0)};U([...T,e]),L({tipo:"peca",descricao:"",quantidade:1,valorUnitario:0}),B(!1),H("");const a={...R};delete a.novoItem,P(a)},className:"mt-3",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Adicionar Item"]})]}),T.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Itens Adicionados"}),T.map(((a,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:[s+1,". ",a.descricao]}),e.jsx("span",{className:"px-2 py-1 text-xs rounded "+("peca"===a.tipo?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:"peca"===a.tipo?"Peça":"Serviço"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Qtd: ",a.quantidade," × R$ ",a.valorUnitario.toFixed(2)," = R$ ",a.valorTotal.toFixed(2)]})]}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>{return e=a.id,void U(T.filter((a=>a.id!==e)));var e},className:"text-red-600 hover:text-red-700",children:e.jsx(f,{className:"w-4 h-4"})})]},a.id)))]}),R.itens&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:R.itens})]})]}),e.jsxs(c,{children:[e.jsx(m,{children:e.jsx(u,{children:"Informações Adicionais"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"observacoes",children:"Observações"}),e.jsx("textarea",{id:"observacoes",value:z.observacoes,onChange:e=>O({...z,observacoes:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Observações sobre o orçamento..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"validade",children:"Válido até *"}),e.jsx(h,{id:"validade",type:"date",value:z.validadeAte,onChange:e=>O({...z,validadeAte:e.target.value}),className:R.validadeAte?"border-red-500":""}),R.validadeAte&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:R.validadeAte})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"desconto",children:"Desconto (R$)"}),e.jsx(h,{id:"desconto",type:"number",step:"0.01",min:"0",value:z.valorDesconto,onChange:e=>O({...z,valorDesconto:parseFloat(e.target.value)||0})})]})]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(c,{className:"sticky top-4",children:[e.jsx(m,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Resumo do Orçamento"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Peças:"}),e.jsxs("span",{children:["R$ ",Y.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Serviços:"}),e.jsxs("span",{children:["R$ ",Z.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["R$ ",_.toFixed(2)]})]}),z.valorDesconto>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Desconto:"}),e.jsxs("span",{children:["- R$ ",z.valorDesconto.toFixed(2)]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["R$ ",ee.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsxs(t,{onClick:()=>J(!1),disabled:D,className:"w-full",variant:"outline",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),D?"Salvando...":"Salvar Rascunho"]}),e.jsxs(t,{onClick:()=>J(!0),disabled:D,className:"w-full",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),D?"Enviando...":"Salvar e Enviar"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 pt-2",children:[e.jsx("p",{children:"• O orçamento será salvo como pendente"}),e.jsx("p",{children:"• Cliente receberá por email e WhatsApp"}),e.jsxs("p",{children:["• Validade: ",z.validadeAte?new Date(z.validadeAte).toLocaleDateString("pt-BR"):"Não definida"]})]})]})]})})]})]})}export{q as default};
