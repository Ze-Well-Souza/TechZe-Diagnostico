import{j as e}from"../vendor/vendor-query.CYtcMPNU.js";import{a,u as t}from"../vendor/vendor-react.C0-ekqbG.js";import{k as s,i as r,X as o,v as i,a as n,D as d,b as c,c as l,d as m,e as u,C as x,T as h,I as p,g as f,L as j}from"../entry/index.BTJ1QXK9.js";import{B as g}from"./badge.BCKbA_Tg.js";import{S as v,a as w,b as N,c as y,d as q}from"./select.D75MbHUz.js";import{a as b,T as _,P as E,C,L as z,b as S,S as I,c as D,d as k,e as R,f as B,g as F,h as T,i as M,j as $,D as A,O as P}from"../vendor/vendor-ui.TbV-WW-S.js";import{C as L}from"./chevron-right.DN28NIWR.js";import{T as V}from"./textarea.Cq5ZZB-C.js";import{t as O}from"./use-toast.DAVCncE5.js";import{U as Q}from"./upload.CktljbQS.js";import{P as H}from"./plus.BUsgb2rM.js";import{P as G}from"./package.fhd-M5KA.js";import{S as U}from"./search.x8-RwjLr.js";import{S as J}from"./square-pen.EayU8wcR.js";import{T as K}from"./trash-2.D_atw9Vw.js";import{T as W}from"./trending-up.B7GeU7Km.js";import{T as X}from"./trending-down.BtsJ1fhi.js";import"../vendor/vendor-supabase.CnuDrxPg.js";import"../vendor/vendor-utils.Cp7Vw4Xn.js";const Y=s("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Z=s("package-2",[["path",{d:"M12 3v6",key:"1holv5"}],["path",{d:"M16.76 3a2 2 0 0 1 1.8 1.1l2.23 4.479a2 2 0 0 1 .21.891V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9.472a2 2 0 0 1 .211-.894L5.45 4.1A2 2 0 0 1 7.24 3z",key:"187q7i"}],["path",{d:"M3.054 9.013h17.893",key:"grwhos"}]]),ee=a.forwardRef((({className:a,...t},s)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:s,className:r("w-full caption-bottom text-sm",a),...t})})));ee.displayName="Table";const ae=a.forwardRef((({className:a,...t},s)=>e.jsx("thead",{ref:s,className:r("[&_tr]:border-b",a),...t})));ae.displayName="TableHeader";const te=a.forwardRef((({className:a,...t},s)=>e.jsx("tbody",{ref:s,className:r("[&_tr:last-child]:border-0",a),...t})));te.displayName="TableBody";a.forwardRef((({className:a,...t},s)=>e.jsx("tfoot",{ref:s,className:r("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...t}))).displayName="TableFooter";const se=a.forwardRef((({className:a,...t},s)=>e.jsx("tr",{ref:s,className:r("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...t})));se.displayName="TableRow";const re=a.forwardRef((({className:a,...t},s)=>e.jsx("th",{ref:s,className:r("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...t})));re.displayName="TableHead";const oe=a.forwardRef((({className:a,...t},s)=>e.jsx("td",{ref:s,className:r("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...t})));oe.displayName="TableCell";a.forwardRef((({className:a,...t},s)=>e.jsx("caption",{ref:s,className:r("mt-4 text-sm text-muted-foreground",a),...t}))).displayName="TableCaption";const ie=b,ne=_;a.forwardRef((({className:a,inset:t,children:s,...o},i)=>e.jsxs(D,{ref:i,className:r("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",a),...o,children:[s,e.jsx(L,{className:"ml-auto h-4 w-4"})]}))).displayName=D.displayName;a.forwardRef((({className:a,...t},s)=>e.jsx(k,{ref:s,className:r("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}))).displayName=k.displayName;const de=a.forwardRef((({className:a,sideOffset:t=4,...s},o)=>e.jsx(E,{children:e.jsx(C,{ref:o,sideOffset:t,className:r("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})})));de.displayName=C.displayName;const ce=a.forwardRef((({className:a,inset:t,...s},o)=>e.jsx(S,{ref:o,className:r("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",a),...s})));ce.displayName=S.displayName;const le=a.forwardRef((({className:a,inset:t,...s},o)=>e.jsx(z,{ref:o,className:r("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",a),...s})));le.displayName=z.displayName;const me=a.forwardRef((({className:a,...t},s)=>e.jsx(I,{ref:s,className:r("-mx-1 my-1 h-px bg-muted",a),...t})));me.displayName=I.displayName;const ue=R,xe=B,he=F,pe=a.forwardRef((({className:a,...t},s)=>e.jsx(P,{ref:s,className:r("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t})));pe.displayName=P.displayName;const fe=a.forwardRef((({className:a,children:t,...s},i)=>e.jsxs(he,{children:[e.jsx(pe,{}),e.jsxs(T,{ref:i,className:r("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s,children:[t,e.jsxs(M,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(o,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));fe.displayName=T.displayName;const je=({className:a,...t})=>e.jsx("div",{className:r("flex flex-col space-y-1.5 text-center sm:text-left",a),...t});je.displayName="DialogHeader";const ge=({className:a,...t})=>e.jsx("div",{className:r("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t});ge.displayName="DialogFooter";const ve=a.forwardRef((({className:a,...t},s)=>e.jsx($,{ref:s,className:r("text-lg font-semibold leading-none tracking-tight",a),...t})));ve.displayName=$.displayName;const we=a.forwardRef((({className:a,...t},s)=>e.jsx(A,{ref:s,className:r("text-sm text-muted-foreground",a),...t})));we.displayName=A.displayName;const Ne=new class{determinarStatus(e,a){return 0===e?"esgotado":e<=a?"baixo_estoque":"disponivel"}mapearItemDB(e){return{id:e.id,nome:e.nome,descricao:e.descricao,categoria:e.categoria,codigo:e.codigo,preco_custo:e.preco_custo,preco_venda:e.preco_venda,quantidade_atual:e.quantidade_atual,quantidade_minima:e.quantidade_minima,fornecedor:e.fornecedor,localizacao:e.localizacao,status:e.status||this.determinarStatus(e.quantidade_atual,e.quantidade_minima),criadoEm:new Date(e.created_at),atualizadoEm:new Date(e.updated_at)}}mapearMovimentacaoDB(e){return{id:e.id,item_id:e.item_id,tipo:e.tipo,quantidade:e.quantidade,quantidade_anterior:e.quantidade_anterior,quantidade_nova:e.quantidade_nova,motivo:e.motivo,observacoes:e.observacoes,usuario_id:e.usuario_id,criadoEm:new Date(e.created_at)}}async listarItens(){try{const{data:e,error:a}=await i.from("estoque_itens").select("*").order("nome",{ascending:!0});if(a)throw new Error(`Erro ao listar itens: ${a.message}`);return e?.map((e=>this.mapearItemDB(e)))||[]}catch(e){throw e}}async buscarPorCodigo(e){try{const{data:a,error:t}=await i.from("estoque_itens").select("*").eq("codigo",e).single();if(t){if("PGRST116"===t.code)return null;throw new Error(`Erro ao buscar item: ${t.message}`)}return this.mapearItemDB(a)}catch(a){throw a}}async obterDetalhes(e){try{const{data:a,error:t}=await i.from("estoque_itens").select("*").eq("id",e).single();if(t)throw new Error(`Erro ao obter detalhes: ${t.message}`);return this.mapearItemDB(a)}catch(a){throw a}}async criar(e){try{const a=this.determinarStatus(e.quantidade_atual,e.quantidade_minima),t={nome:e.nome,descricao:e.descricao,categoria:e.categoria,codigo:e.codigo,preco_custo:e.preco_custo,preco_venda:e.preco_venda,quantidade_atual:e.quantidade_atual,quantidade_minima:e.quantidade_minima,fornecedor:e.fornecedor,localizacao:e.localizacao,status:a},{data:s,error:r}=await i.from("estoque_itens").insert(t).select().single();if(r)throw new Error(`Erro ao criar item: ${r.message}`);return e.quantidade_atual>0&&await this.registrarMovimentacao(s.id,"entrada",e.quantidade_atual,0,e.quantidade_atual,"Estoque inicial"),this.mapearItemDB(s)}catch(a){throw a}}async atualizar(e,a){try{const t={...a};if(void 0!==a.quantidade_atual||void 0!==a.quantidade_minima){const s=await this.obterDetalhes(e),r=a.quantidade_atual??s.quantidade_atual,o=a.quantidade_minima??s.quantidade_minima;t.status=this.determinarStatus(r,o)}const{error:s}=await i.from("estoque_itens").update(t).eq("id",e);if(s)throw new Error(`Erro ao atualizar item: ${s.message}`)}catch(t){throw t}}async excluir(e){try{const{data:a,error:t}=await i.from("estoque_movimentacoes").select("id").eq("item_id",e).limit(1);if(t)throw new Error(`Erro ao verificar movimentações: ${t.message}`);if(a&&a.length>0)return void(await this.atualizar(e,{status:"descontinuado"}));const{error:s}=await i.from("estoque_itens").delete().eq("id",e);if(s)throw new Error(`Erro ao excluir item: ${s.message}`)}catch(a){throw a}}async ajustarEstoque(e,a,t,s,r){try{const o=await this.obterDetalhes(e),n=o.quantidade_atual,d="entrada"===a?n+t:n-t;if(d<0)throw new Error("Quantidade insuficiente em estoque");const c=this.determinarStatus(d,o.quantidade_minima);await i.from("estoque_itens").update({quantidade_atual:d,status:c}).eq("id",e);return await this.registrarMovimentacao(e,a,t,n,d,s,r)}catch(o){throw o}}async registrarMovimentacao(e,a,t,s,r,o,n){try{const{data:{user:d}}=await i.auth.getUser(),c={item_id:e,tipo:a,quantidade:t,quantidade_anterior:s,quantidade_nova:r,motivo:o,observacoes:n,usuario_id:d?.id||"sistema"},{data:l,error:m}=await i.from("estoque_movimentacoes").insert(c).select().single();if(m)throw new Error(`Erro ao registrar movimentação: ${m.message}`);return this.mapearMovimentacaoDB(l)}catch(d){throw d}}async listarMovimentacoes(e){try{let a=i.from("estoque_movimentacoes").select("\n          *,\n          estoque_itens(nome, codigo)\n        ").order("created_at",{ascending:!1});e&&(a=a.eq("item_id",e));const{data:t,error:s}=await a;if(s)throw new Error(`Erro ao listar movimentações: ${s.message}`);return t?.map((e=>this.mapearMovimentacaoDB(e)))||[]}catch(a){throw a}}async listarBaixoEstoque(){try{const{data:e,error:a}=await i.from("estoque_itens").select("*").or("status.eq.baixo_estoque,status.eq.esgotado").order("quantidade_atual",{ascending:!0});if(a)throw new Error(`Erro ao listar itens com baixo estoque: ${a.message}`);return e?.map((e=>this.mapearItemDB(e)))||[]}catch(e){throw e}}async obterEstatisticas(){try{const{data:e,error:a}=await i.from("estoque_itens").select("quantidade_atual, preco_custo, status");if(a)throw new Error(`Erro ao obter estatísticas de itens: ${a.message}`);const t=new Date;t.setDate(1),t.setHours(0,0,0,0);const{data:s,error:r}=await i.from("estoque_movimentacoes").select("\n          quantidade,\n          tipo,\n          estoque_itens(preco_custo)\n        ").gte("created_at",t.toISOString());if(r)throw new Error(`Erro ao obter movimentações: ${r.message}`);const o=e?.length||0,n=e?.filter((e=>"descontinuado"!==e.status)).length||0,d=e?.reduce(((e,a)=>e+a.quantidade_atual*a.preco_custo),0)||0,c=e?.filter((e=>"baixo_estoque"===e.status)).length||0,l=e?.filter((e=>"esgotado"===e.status)).length||0;return{totalItens:o,itensAtivos:n,valorTotal:d,itensBaixoEstoque:c,itensEsgotados:l,movimentacoesMes:s?.length||0,valorMovimentacoesMes:s?.reduce(((e,a)=>{const t=a.estoque_itens?.preco_custo||0;return e+a.quantidade*t}),0)||0}}catch(e){throw e}}async exportarItens(){try{const e=await this.listarItens(),a=[["Código","Nome","Descrição","Categoria","Quantidade Atual","Quantidade Mínima","Preço Custo","Preço Venda","Fornecedor","Localização","Status"].join(","),...e.map((e=>[e.codigo,`"${e.nome}"`,`"${e.descricao||""}"`,e.categoria,e.quantidade_atual,e.quantidade_minima,e.preco_custo,e.preco_venda,`"${e.fornecedor||""}"`,`"${e.localizacao||""}"`,e.status].join(",")))].join("\n");return new Blob([a],{type:"text/csv;charset=utf-8;"})}catch(e){throw e}}};const ye={disponivel:{label:"Disponível",color:"bg-green-500",variant:"default"},baixo_estoque:{label:"Baixo Estoque",color:"bg-yellow-500",variant:"secondary"},esgotado:{label:"Esgotado",color:"bg-red-500",variant:"destructive"},descontinuado:{label:"Descontinuado",color:"bg-gray-500",variant:"outline"}},qe=["Peças de Reposição","Ferramentas","Acessórios","Componentes Eletrônicos","Materiais de Limpeza","Outros"];function be(){t();const{itens:s,estatisticas:r,loading:o,carregarItens:i,criarItem:b,atualizarItem:_,excluirItem:E,ajustarEstoque:C,carregarEstatisticas:z}=function(e={}){const{autoLoad:t=!0}=e,[s,r]=a.useState([]),[o,i]=a.useState([]),[n,d]=a.useState(null),[c,l]=a.useState(!1),[m,u]=a.useState(null),x=a.useCallback((async()=>{try{l(!0),u(null);const e=await Ne.listarItens();r(e)}catch(e){const a=e instanceof Error?e.message:"Erro ao carregar itens";u(a),O({title:"Erro",description:a,variant:"destructive"})}finally{l(!1)}}),[]),h=a.useCallback((async e=>{try{l(!0),u(null);const a=await Ne.listarMovimentacoes(e);i(a)}catch(a){const e=a instanceof Error?a.message:"Erro ao carregar movimentações";u(e),O({title:"Erro",description:e,variant:"destructive"})}finally{l(!1)}}),[]),p=a.useCallback((async()=>{try{const e=await Ne.obterEstatisticas();d(e)}catch(e){}}),[]),f=a.useCallback((async e=>{try{if(u(null),await Ne.buscarPorCodigo(e.codigo))throw new Error("Já existe um item com este código");const a=await Ne.criar(e);return r((e=>[a,...e])),await p(),a}catch(a){const e=a instanceof Error?a.message:"Erro ao criar item";throw u(e),O({title:"Erro",description:e,variant:"destructive"}),a}}),[p]),j=a.useCallback((async(e,a)=>{try{u(null),await Ne.atualizar(e,a),r((t=>t.map((t=>t.id===e?{...t,...a,atualizadoEm:new Date}:t)))),await p()}catch(t){const e=t instanceof Error?t.message:"Erro ao atualizar item";throw u(e),O({title:"Erro",description:e,variant:"destructive"}),t}}),[p]),g=a.useCallback((async e=>{try{u(null),await Ne.excluir(e),r((a=>a.filter((a=>a.id!==e)))),await p()}catch(a){const e=a instanceof Error?a.message:"Erro ao excluir item";throw u(e),O({title:"Erro",description:e,variant:"destructive"}),a}}),[p]),v=a.useCallback((async(e,a,t,s,o)=>{try{u(null);const n=await Ne.ajustarEstoque(e,a,t,s,o);r((s=>s.map((s=>{if(s.id===e){const e="entrada"===a?s.quantidade_atual+t:s.quantidade_atual-t;let r="disponivel";return 0===e?r="esgotado":e<=s.quantidade_minima&&(r="baixo_estoque"),{...s,quantidade_atual:e,status:r,atualizadoEm:new Date}}return s})))),i((e=>[n,...e])),await p()}catch(n){const e=n instanceof Error?n.message:"Erro ao ajustar estoque";throw u(e),O({title:"Erro",description:e,variant:"destructive"}),n}}),[p]),w=a.useCallback((async e=>{try{return await Ne.buscarPorCodigo(e)}catch(a){return null}}),[]),N=a.useCallback((async()=>{try{return await Ne.listarBaixoEstoque()}catch(e){return[]}}),[]);return{itens:s,movimentacoes:o,estatisticas:n,loading:c,error:m,carregarItens:x,carregarMovimentacoes:h,carregarEstatisticas:p,criarItem:f,atualizarItem:j,excluirItem:g,ajustarEstoque:v,buscarItem:w,verificarBaixoEstoque:N}}(),[S,I]=a.useState(""),[D,k]=a.useState("todos"),[R,B]=a.useState("todos"),[F,T]=a.useState(!1),[M,$]=a.useState(null),[A,P]=a.useState(!1),[L,he]=a.useState(null),[pe,be]=a.useState({nome:"",descricao:"",categoria:"",codigo:"",preco_custo:"",preco_venda:"",quantidade_atual:"",quantidade_minima:"",fornecedor:"",localizacao:""}),[_e,Ee]=a.useState({tipo:"entrada",quantidade:"",motivo:"",observacoes:""});a.useEffect((()=>{i(),z()}),[i,z]);const Ce=s.filter((e=>{const a=e.nome.toLowerCase().includes(S.toLowerCase())||e.codigo.toLowerCase().includes(S.toLowerCase()),t="todos"===D||e.categoria===D,s="todos"===R||e.status===R;return a&&t&&s})),ze=()=>{be({nome:"",descricao:"",categoria:"",codigo:"",preco_custo:"",preco_venda:"",quantidade_atual:"",quantidade_minima:"",fornecedor:"",localizacao:""}),$(null)};return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Gestão de Estoque"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie o inventário de peças e materiais"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Exportar"]}),e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Importar"]}),e.jsx(ue,{open:F,onOpenChange:T,children:e.jsx(xe,{asChild:!0,children:e.jsxs(n,{onClick:ze,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Novo Item"]})})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total de Itens"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r?.totalItens||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r?.itensAtivos||0," ativos"]})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Valor Total"}),e.jsx(x,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",(r?.valorTotal||0).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor do inventário"})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Baixo Estoque"}),e.jsx(h,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:r?.itensBaixoEstoque||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Itens com estoque baixo"})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Esgotados"}),e.jsx(Z,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r?.itensEsgotados||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Itens sem estoque"})]})]})]}),e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(m,{children:"Filtros"})}),e.jsx(u,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Buscar por nome ou código...",value:S,onChange:e=>I(e.target.value),className:"pl-8"})]})}),e.jsxs(v,{value:D,onValueChange:k,children:[e.jsx(w,{className:"w-[200px]",children:e.jsx(N,{placeholder:"Categoria"})}),e.jsxs(y,{children:[e.jsx(q,{value:"todos",children:"Todas as categorias"}),qe.map((a=>e.jsx(q,{value:a,children:a},a)))]})]}),e.jsxs(v,{value:R,onValueChange:B,children:[e.jsx(w,{className:"w-[150px]",children:e.jsx(N,{placeholder:"Status"})}),e.jsxs(y,{children:[e.jsx(q,{value:"todos",children:"Todos os status"}),e.jsx(q,{value:"disponivel",children:"Disponível"}),e.jsx(q,{value:"baixo_estoque",children:"Baixo Estoque"}),e.jsx(q,{value:"esgotado",children:"Esgotado"}),e.jsx(q,{value:"descontinuado",children:"Descontinuado"})]})]})]})})]}),e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsx(m,{children:"Itens do Estoque"}),e.jsxs(f,{children:[Ce.length," itens encontrados"]})]}),e.jsx(u,{children:e.jsxs(ee,{children:[e.jsx(ae,{children:e.jsxs(se,{children:[e.jsx(re,{children:"Código"}),e.jsx(re,{children:"Nome"}),e.jsx(re,{children:"Categoria"}),e.jsx(re,{children:"Quantidade"}),e.jsx(re,{children:"Preço"}),e.jsx(re,{children:"Status"}),e.jsx(re,{className:"text-right",children:"Ações"})]})}),e.jsx(te,{children:Ce.map((a=>e.jsxs(se,{children:[e.jsx(oe,{className:"font-mono",children:a.codigo}),e.jsx(oe,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.nome}),a.descricao&&e.jsx("div",{className:"text-sm text-muted-foreground",children:a.descricao})]})}),e.jsx(oe,{children:a.categoria}),e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:a.quantidade_atual<=a.quantidade_minima?"text-red-600 font-medium":"",children:a.quantidade_atual}),e.jsxs("span",{className:"text-muted-foreground",children:["/ ",a.quantidade_minima]})]})}),e.jsxs(oe,{children:["R$ ",a.preco_venda.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx(oe,{children:e.jsx(g,{variant:ye[a.status]?.variant,children:ye[a.status]?.label})}),e.jsx(oe,{className:"text-right",children:e.jsxs(ie,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(n,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsxs(de,{align:"end",children:[e.jsx(le,{children:"Ações"}),e.jsxs(ce,{onClick:()=>(e=>{$(e),be({nome:e.nome,descricao:e.descricao||"",categoria:e.categoria,codigo:e.codigo,preco_custo:e.preco_custo.toString(),preco_venda:e.preco_venda.toString(),quantidade_atual:e.quantidade_atual.toString(),quantidade_minima:e.quantidade_minima.toString(),fornecedor:e.fornecedor||"",localizacao:e.localizacao||""}),T(!0)})(a),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Editar"]}),e.jsxs(ce,{onClick:()=>(e=>{he(e),P(!0)})(a),children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Ajustar Estoque"]}),e.jsx(me,{}),e.jsxs(ce,{onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir este item?"))try{await E(e),O({title:"Sucesso",description:"Item excluído com sucesso!"})}catch(a){}})(a.id),className:"text-red-600",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Excluir"]})]})]})})]},a.id)))})]})})]}),e.jsxs(fe,{className:"max-w-2xl",children:[e.jsxs(je,{children:[e.jsx(ve,{children:M?"Editar Item":"Novo Item"}),e.jsx(we,{children:M?"Edite as informações do item.":"Adicione um novo item ao estoque."})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e={...pe,preco_custo:parseFloat(pe.preco_custo),preco_venda:parseFloat(pe.preco_venda),quantidade_atual:parseInt(pe.quantidade_atual),quantidade_minima:parseInt(pe.quantidade_minima)};M?(await _(M.id,e),O({title:"Sucesso",description:"Item atualizado com sucesso!"})):(await b(e),O({title:"Sucesso",description:"Item criado com sucesso!"})),T(!1),ze()}catch(a){}},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"nome",children:"Nome *"}),e.jsx(p,{id:"nome",value:pe.nome,onChange:e=>be((a=>({...a,nome:e.target.value}))),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"codigo",children:"Código *"}),e.jsx(p,{id:"codigo",value:pe.codigo,onChange:e=>be((a=>({...a,codigo:e.target.value}))),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"descricao",children:"Descrição"}),e.jsx(V,{id:"descricao",value:pe.descricao,onChange:e=>be((a=>({...a,descricao:e.target.value})))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"categoria",children:"Categoria *"}),e.jsxs(v,{value:pe.categoria,onValueChange:e=>be((a=>({...a,categoria:e}))),children:[e.jsx(w,{children:e.jsx(N,{placeholder:"Selecione uma categoria"})}),e.jsx(y,{children:qe.map((a=>e.jsx(q,{value:a,children:a},a)))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"fornecedor",children:"Fornecedor"}),e.jsx(p,{id:"fornecedor",value:pe.fornecedor,onChange:e=>be((a=>({...a,fornecedor:e.target.value})))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"preco_custo",children:"Preço de Custo *"}),e.jsx(p,{id:"preco_custo",type:"number",step:"0.01",value:pe.preco_custo,onChange:e=>be((a=>({...a,preco_custo:e.target.value}))),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"preco_venda",children:"Preço de Venda *"}),e.jsx(p,{id:"preco_venda",type:"number",step:"0.01",value:pe.preco_venda,onChange:e=>be((a=>({...a,preco_venda:e.target.value}))),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"quantidade_atual",children:"Quantidade Atual *"}),e.jsx(p,{id:"quantidade_atual",type:"number",value:pe.quantidade_atual,onChange:e=>be((a=>({...a,quantidade_atual:e.target.value}))),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"quantidade_minima",children:"Quantidade Mínima *"}),e.jsx(p,{id:"quantidade_minima",type:"number",value:pe.quantidade_minima,onChange:e=>be((a=>({...a,quantidade_minima:e.target.value}))),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"localizacao",children:"Localização"}),e.jsx(p,{id:"localizacao",value:pe.localizacao,onChange:e=>be((a=>({...a,localizacao:e.target.value}))),placeholder:"Ex: A1-B2"})]})]})]}),e.jsxs(ge,{children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>T(!1),children:"Cancelar"}),e.jsx(n,{type:"submit",children:M?"Atualizar":"Criar"})]})]})]}),e.jsx(ue,{open:A,onOpenChange:P,children:e.jsxs(fe,{children:[e.jsxs(je,{children:[e.jsx(ve,{children:"Ajustar Estoque"}),e.jsxs(we,{children:["Ajuste o estoque do item: ",L?.nome]})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{await C(L.id,_e.tipo,parseInt(_e.quantidade),_e.motivo,_e.observacoes),O({title:"Sucesso",description:"Estoque ajustado com sucesso!"}),P(!1),Ee({tipo:"entrada",quantidade:"",motivo:"",observacoes:""})}catch(a){}},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Tipo de Ajuste"}),e.jsxs(v,{value:_e.tipo,onValueChange:e=>Ee((a=>({...a,tipo:e}))),children:[e.jsx(w,{children:e.jsx(N,{})}),e.jsxs(y,{children:[e.jsx(q,{value:"entrada",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-green-600"}),"Entrada (+)"]})}),e.jsx(q,{value:"saida",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-red-600"}),"Saída (-)"]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"quantidade",children:"Quantidade *"}),e.jsx(p,{id:"quantidade",type:"number",min:"1",value:_e.quantidade,onChange:e=>Ee((a=>({...a,quantidade:e.target.value}))),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"motivo",children:"Motivo *"}),e.jsx(p,{id:"motivo",value:_e.motivo,onChange:e=>Ee((a=>({...a,motivo:e.target.value}))),placeholder:"Ex: Compra, Venda, Perda, Correção",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"observacoes",children:"Observações"}),e.jsx(V,{id:"observacoes",value:_e.observacoes,onChange:e=>Ee((a=>({...a,observacoes:e.target.value}))),placeholder:"Informações adicionais sobre o ajuste"})]})]}),e.jsxs(ge,{children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancelar"}),e.jsx(n,{type:"submit",children:"Confirmar Ajuste"})]})]})]})})]})}export{be as default};
