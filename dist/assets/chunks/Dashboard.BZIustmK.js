import{j as e}from"../vendor/vendor-query.CYtcMPNU.js";import{a as s,L as t}from"../vendor/vendor-react.C0-ekqbG.js";import{u as a,M as c,B as r,a as i,C as l,U as n,b as o,c as d,d as m,e as x,f as h,T as j,g}from"../entry/index.BTJ1QXK9.js";import{d as u}from"./diagnosticApiService.Fv9Zi4bb.js";import{L as N}from"./log-out.BkHA6lQO.js";import{P as p}from"./plus.BUsgb2rM.js";import{F as f}from"./file-text.LuSAC_HD.js";import{S as v}from"./settings.BLeElVKi.js";import{A as b}from"./activity.Bku7NG6a.js";import{T as w}from"./trending-up.B7GeU7Km.js";import"../vendor/vendor-supabase.CnuDrxPg.js";import"../vendor/vendor-utils.Cp7Vw4Xn.js";function D(){const{user:D,company:y,signOut:S}=a(),[k,_]=s.useState({totalDiagnostics:0,totalDevices:0,avgHealthScore:0,recentDiagnostics:[],todayDiagnostics:0,weekDiagnostics:0,monthDiagnostics:0,criticalDevices:0,warningDevices:0,healthyDevices:0}),[z,T]=s.useState(!0),[C,E]=s.useState("today");s.useEffect((()=>{L();const e=setInterval(L,3e4);return()=>clearInterval(e)}),[]);const L=async()=>{try{const[e,s]=await Promise.all([u.getDiagnostics(),u.getDevices()]),t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),c=new Date(a.getTime()-6048e5),r=new Date(a.getTime()-2592e6),i=e.filter((e=>new Date(e.created_at)>=a)).length,l=e.filter((e=>new Date(e.created_at)>=c)).length,n=e.filter((e=>new Date(e.created_at)>=r)).length,o=e.length>0?e.reduce(((e,s)=>e+(s.health_score||0)),0)/e.length:0,d=e.filter((e=>(e.health_score||0)<40)).length,m=e.filter((e=>{const s=e.health_score||0;return s>=40&&s<80})).length,x=e.filter((e=>(e.health_score||0)>=80)).length;_({totalDiagnostics:e.length,totalDevices:s.length,avgHealthScore:Math.round(o),recentDiagnostics:e.sort(((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime())).slice(0,8),todayDiagnostics:i,weekDiagnostics:l,monthDiagnostics:n,criticalDevices:d,warningDevices:m,healthyDevices:x})}catch(e){}finally{T(!1)}},R=e=>e>=80?"text-green-400":e>=60?"text-yellow-400":"text-red-400",q=(()=>{switch(C){case"today":return{count:k.todayDiagnostics,label:"Hoje",comparison:k.todayDiagnostics>0?"+"+k.todayDiagnostics:"0"};case"week":return{count:k.weekDiagnostics,label:"Esta Semana",comparison:k.weekDiagnostics>k.todayDiagnostics?"+"+(k.weekDiagnostics-k.todayDiagnostics):"0"};case"month":return{count:k.monthDiagnostics,label:"Este Mês",comparison:k.monthDiagnostics>k.weekDiagnostics?"+"+(k.monthDiagnostics-k.weekDiagnostics):"0"}}})();return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-tech-darker to-tech-dark",children:[e.jsx("header",{className:"border-b border-primary/20 backdrop-blur-md bg-tech-darker/50",children:e.jsx("div",{className:"container-responsive py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 electric-glow",children:e.jsx(c,{className:"h-6 w-6 text-electric"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"tech-font text-xl font-bold neon-text",children:"TechZe Diagnóstico"}),y&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[e.jsx(r,{className:"h-3 w-3"}),e.jsx("span",{children:y.name})]})]})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-right",children:[e.jsxs("p",{className:"font-medium text-white",children:["Gerente: ",D?.email?.split("@")[0]]}),e.jsx("p",{className:"text-xs",children:(new Date).toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:S,className:"electric-border",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Sair"]})]})]})})}),e.jsxs("div",{className:"container-responsive py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(t,{to:"/dashboard-global",children:e.jsxs(i,{className:"btn-electric tech-font font-semibold",size:"lg",children:[e.jsx(l,{className:"mr-2 h-5 w-5"}),"Dashboard Global"]})}),e.jsx(t,{to:"/diagnostic",children:e.jsxs(i,{className:"btn-electric tech-font font-semibold",size:"lg",children:[e.jsx(p,{className:"mr-2 h-5 w-5"}),"Novo Diagnóstico"]})}),e.jsx(t,{to:"/clientes",children:e.jsxs(i,{variant:"outline",className:"electric-border",size:"lg",children:[e.jsx(n,{className:"mr-2 h-5 w-5"}),"Clientes"]})}),e.jsx(t,{to:"/admin/lojas",children:e.jsxs(i,{variant:"outline",className:"electric-border",size:"lg",children:[e.jsx(r,{className:"mr-2 h-5 w-5"}),"Gestão de Lojas"]})}),e.jsxs(i,{variant:"outline",className:"electric-border",size:"lg",children:[e.jsx(f,{className:"mr-2 h-5 w-5"}),"Relatórios"]}),e.jsxs(i,{variant:"outline",className:"electric-border",size:"lg",children:[e.jsx(v,{className:"mr-2 h-5 w-5"}),"Configurações"]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex space-x-2",children:["today","week","month"].map((s=>e.jsx(i,{variant:C===s?"default":"outline",size:"sm",onClick:()=>E(s),className:C===s?"btn-electric":"electric-border",children:"today"===s?"Hoje":"week"===s?"Semana":"Mês"},s)))})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(o,{className:"card-electric",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(m,{className:"text-sm font-medium",children:["Diagnósticos ",q.label]}),e.jsx(b,{className:"h-4 w-4 text-electric"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-3xl font-bold text-electric",children:q.count}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[q.comparison," novos"]})]})]}),e.jsxs(o,{className:"card-electric",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Equipamentos"}),e.jsx(c,{className:"h-4 w-4 text-electric"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-3xl font-bold",children:k.totalDevices}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total cadastrados"})]})]}),e.jsxs(o,{className:"card-electric",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Saúde Média"}),e.jsx(w,{className:"h-4 w-4 text-electric"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:`text-3xl font-bold ${R(k.avgHealthScore)}`,children:[k.avgHealthScore,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Score geral da loja"})]})]}),e.jsxs(o,{className:"card-electric",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Status da Loja"}),e.jsx(n,{className:"h-4 w-4 text-electric"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:"Operacional"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sistema funcionando"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(o,{className:"card-electric",children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center text-green-400",children:[e.jsx(h,{className:"h-5 w-5 mr-2"}),"Equipamentos Saudáveis"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-4xl font-bold text-green-400 mb-2",children:k.healthyDevices}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Funcionando perfeitamente (80%+)"})]})]}),e.jsxs(o,{className:"card-electric",children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center text-yellow-400",children:[e.jsx(j,{className:"h-5 w-5 mr-2"}),"Precisam de Atenção"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-4xl font-bold text-yellow-400 mb-2",children:k.warningDevices}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Requerem manutenção (40-79%)"})]})]}),e.jsxs(o,{className:"card-electric",children:[e.jsx(d,{children:e.jsxs(m,{className:"flex items-center text-red-400",children:[e.jsx(j,{className:"h-5 w-5 mr-2"}),"Estado Crítico"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-4xl font-bold text-red-400 mb-2",children:k.criticalDevices}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Precisam reparo urgente (<40%)"})]})]})]}),e.jsxs(o,{className:"card-electric",children:[e.jsxs(d,{children:[e.jsxs(m,{className:"flex items-center space-x-2",children:[e.jsx(l,{className:"h-5 w-5 text-electric"}),e.jsx("span",{children:"Diagnósticos Recentes"})]}),e.jsx(g,{children:"Últimas análises realizadas na loja - Atualização em tempo real"})]}),e.jsx(x,{children:z?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-electric"})}):0===k.recentDiagnostics.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(c,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum diagnóstico realizado ainda"}),e.jsx("p",{className:"text-sm",children:'Clique em "Novo Diagnóstico" para começar'})]}):e.jsx("div",{className:"space-y-4",children:k.recentDiagnostics.map(((s,t)=>{const a=(r=s.health_score||0)>=80?{text:"Excelente",color:"bg-green-400/20 text-green-400 border-green-400/30"}:r>=60?{text:"Bom",color:"bg-yellow-400/20 text-yellow-400 border-yellow-400/30"}:r>=40?{text:"Regular",color:"bg-orange-400/20 text-orange-400 border-orange-400/30"}:{text:"Crítico",color:"bg-red-400/20 text-red-400 border-red-400/30"};var r,l;return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/5 border border-muted/10 hover:border-electric/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(c,{className:"h-5 w-5 text-electric"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.client_name||"Cliente não informado"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.device?.name||"Dispositivo"," • ",(l=s.created_at,new Date(l).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))]}),s.client_phone&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["📞 ",s.client_phone]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-2xl font-bold ${R(s.health_score||0)}`,children:[s.health_score||0,"%"]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs border ${a.color}`,children:a.text})]}),e.jsxs(i,{variant:"outline",size:"sm",className:"electric-border",children:[e.jsx(f,{className:"h-4 w-4 mr-1"}),"Ver"]})]})]},s.id)}))})})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-muted-foreground",children:[e.jsx("p",{children:"Sistema TechZe Diagnóstico - Versão 3.0"}),e.jsxs("p",{children:["Última atualização: ",(new Date).toLocaleTimeString("pt-BR")]})]})]})]})}export{D as default};
