import{j as e}from"../vendor/vendor-query.CYtcMPNU.js";import{k as s,u as a,a as r}from"../vendor/vendor-react.C0-ekqbG.js";import{k as i,u as t,a as l,A as n,o as c,j as d,p as o,b as m,c as x,d as j,e as h,g as p,t as u,D as v,r as N}from"../entry/index.BTJ1QXK9.js";import{B as f}from"./badge.BCKbA_Tg.js";import{U as g}from"./user.DpJFzjjo.js";import{P as y}from"./phone.D-Ty1FlK.js";import{M as w}from"./mail.O52PZRan.js";import{F as b}from"./file-text.LuSAC_HD.js";import{D,C as S}from"./dollar-sign.BDvHB1j_.js";import{C as E}from"./calendar.C3WoCpfa.js";import{S as R}from"./square-pen.EayU8wcR.js";import{S as q}from"./send.Hwod_5Dq.js";import{P as C}from"./printer.DvBwtgcx.js";import"../vendor/vendor-supabase.CnuDrxPg.js";import"../vendor/vendor-utils.Cp7Vw4Xn.js";const k=i("laptop",[["path",{d:"M18 5a2 2 0 0 1 2 2v8.526a2 2 0 0 0 .212.897l1.068 2.127a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45l1.068-2.127A2 2 0 0 0 4 15.526V7a2 2 0 0 1 2-2z",key:"1pdavp"}],["path",{d:"M20.054 15.987H3.946",key:"14rxg9"}]]);function F(){const{id:i}=s(),F=a(),{user:P}=t(),[z,A]=r.useState(null),[I,$]=r.useState(!0),[B,T]=r.useState(null),[U,L]=r.useState(null);r.useEffect((()=>{i&&O(i)}),[i]);const O=async e=>{try{$(!0);A({id:e,numero:"ORC-2024-001",clienteId:"cliente-1",equipamentoId:"equip-1",status:"pendente",itens:[{tipo:"peca",pecaId:"peca-1",descricao:"Memória RAM 8GB DDR4",quantidade:1,valorUnitario:250},{tipo:"peca",pecaId:"peca-2",descricao:"SSD 500GB Samsung 980 EVO",quantidade:1,valorUnitario:350},{tipo:"servico",descricao:"Instalação e configuração",quantidade:1,valorUnitario:80}],valorPecas:600,valorServicos:80,valorDesconto:30,valorTotal:650,observacoes:"Upgrade de memória e armazenamento para melhorar performance do notebook.",validadeAte:new Date("2024-02-15"),criadoEm:new Date("2024-02-01"),atualizadoEm:new Date("2024-02-01"),cliente:{id:"cliente-1",nome:"João Silva",email:"joao@email.com",telefone:"(11) 99999-9999",cpf:"123.456.789-00",criadoEm:new Date,atualizadoEm:new Date},equipamento:{id:"equip-1",clienteId:"cliente-1",tipo:"notebook",marca:"Dell",modelo:"Inspiron 15",numeroSerie:"DL123456",descricaoProblema:"Lentidão e travamentos",criadoEm:new Date,atualizadoEm:new Date}})}catch(s){L("Erro ao carregar orçamento. Tente novamente.")}finally{$(!1)}},M=async e=>{if(z)try{T(e),A({...z,status:e,atualizadoEm:new Date})}catch(s){L("Erro ao atualizar status. Tente novamente.")}finally{T(null)}},V=z&&new Date>z.validadeAte,G=z&&["pendente"].includes(z.status)&&!V,H=z&&"pendente"===z.status&&!V;return I?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando orçamento..."})]})})}):U||!z?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"flex items-center gap-4 mb-8",children:e.jsxs(l,{variant:"outline",onClick:()=>F("/orcamentos"),children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"Voltar"]})}),e.jsxs(c,{children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx(o,{children:U||"Orçamento não encontrado."})]})]}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(l,{variant:"outline",onClick:()=>F("/orcamentos"),children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:["Orçamento ",z.numero]}),e.jsxs("p",{className:"text-gray-600",children:["Criado em ",z.criadoEm.toLocaleDateString("pt-BR")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{className:`${(e=>{switch(e){case"pendente":return"bg-yellow-100 text-yellow-800";case"aprovado":return"bg-green-100 text-green-800";case"rejeitado":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(z.status)} flex items-center gap-1`,children:[(s=>{switch(s){case"pendente":default:return e.jsx(N,{className:"w-4 h-4"});case"aprovado":return e.jsx(u,{className:"w-4 h-4"});case"rejeitado":return e.jsx(S,{className:"w-4 h-4"});case"expirado":return e.jsx(d,{className:"w-4 h-4"})}})(z.status),z.status.charAt(0).toUpperCase()+z.status.slice(1)]}),V&&"pendente"===z.status&&e.jsxs(f,{className:"bg-red-100 text-red-800",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"Expirado"]})]})]}),U&&e.jsxs(c,{className:"mb-6",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx(o,{children:U})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"}),"Cliente"]})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-lg",children:z.cliente?.nome}),e.jsx("p",{className:"text-gray-600",children:z.cliente?.cpf})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(y,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:z.cliente?.telefone})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(w,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:z.cliente?.email})]})]})]})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Equipamento"]})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-lg",children:[z.equipamento?.marca," ",z.equipamento?.modelo]}),e.jsx("p",{className:"text-gray-600 capitalize",children:z.equipamento?.tipo})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Série:"})," ",z.equipamento?.numeroSerie]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Problema:"})," ",z.equipamento?.descricaoProblema]})]})]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(j,{children:"Itens do Orçamento"}),e.jsxs(p,{children:[z.itens.length," ",1===z.itens.length?"item":"itens"]})]}),e.jsx(h,{children:e.jsx("div",{className:"space-y-3",children:z.itens.map(((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.descricao}),e.jsx(f,{variant:"outline",className:"peca"===s.tipo?"text-blue-600":"text-green-600",children:"peca"===s.tipo?"Peça":"Serviço"})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Quantidade: ",s.quantidade," × R$ ",s.valorUnitario.toFixed(2)]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-medium",children:["R$ ",(s.quantidade*s.valorUnitario).toFixed(2)]})})]},a)))})})]}),z.observacoes&&e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Observações"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:z.observacoes})})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Resumo Financeiro"]})}),e.jsx(h,{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Peças:"}),e.jsxs("span",{children:["R$ ",z.valorPecas.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Serviços:"}),e.jsxs("span",{children:["R$ ",z.valorServicos.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["R$ ",(z.valorPecas+z.valorServicos).toFixed(2)]})]}),z.valorDesconto>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Desconto:"}),e.jsxs("span",{children:["- R$ ",z.valorDesconto.toFixed(2)]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["R$ ",z.valorTotal.toFixed(2)]})]})]})})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Validade"]})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Válido até:"}),e.jsx("div",{className:"font-medium "+(V?"text-red-600":"text-gray-900"),children:z.validadeAte.toLocaleDateString("pt-BR")})]}),V&&e.jsxs("div",{className:"text-sm text-red-600",children:[e.jsx(d,{className:"w-4 h-4 inline mr-1"}),"Orçamento expirado"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Última atualização:"}),e.jsxs("div",{className:"font-medium",children:[z.atualizadoEm.toLocaleDateString("pt-BR")," às ",z.atualizadoEm.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]})})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(j,{children:"Ações"})}),e.jsxs(h,{className:"space-y-3",children:[H&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{onClick:()=>M("aprovado"),disabled:"aprovado"===B,className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"aprovado"===B?"Aprovando...":"Aprovar"]}),e.jsxs(l,{onClick:()=>M("rejeitado"),disabled:"rejeitado"===B,variant:"outline",className:"w-full text-red-600 border-red-600 hover:bg-red-50",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"rejeitado"===B?"Rejeitando...":"Rejeitar"]})]}),e.jsxs("div",{className:"space-y-2",children:[G&&e.jsxs(l,{onClick:()=>F(`/orcamentos/${z.id}/editar`),variant:"outline",className:"w-full",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(l,{onClick:async()=>{if(z)try{T("reenviar")}catch(e){L("Erro ao reenviar orçamento. Tente novamente.")}finally{T(null)}},disabled:"reenviar"===B,variant:"outline",className:"w-full",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"reenviar"===B?"Enviando...":"Reenviar"]}),e.jsxs(l,{onClick:async()=>{if(z)try{T("pdf")}catch(e){L("Erro ao gerar PDF. Tente novamente.")}finally{T(null)}},disabled:"pdf"===B,variant:"outline",className:"w-full",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"pdf"===B?"Gerando...":"Baixar PDF"]}),e.jsxs(l,{onClick:()=>window.print(),variant:"outline",className:"w-full",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Imprimir"]})]})]})]})]})]})]})}export{F as default};
